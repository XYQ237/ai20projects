2020 IEEE International Conference on Robotics and Automation (ICRA)
31 May - 31 August, 2020. Paris, France
Wasserstein Distributionally Robust Motion Planning and Control
with Safety Constraints Using Conditional Value-at-Risk
Astghik Hakobyan Insoon Yang
Abstract—In this paper, we propose an optimization-based tools have been developed using a particle-based approxi-
decision-making tool for safe motion planning and control in mation [6], and semideﬁnite programming formulation [7],
an environment with randomly moving obstacles. The unique
among others. Another approach is to use a risk measure,
feature of the proposed method is that it limits the risk
which is computationally tractable to handle. In particular,
of unsafety by a pre-speciﬁed threshold even when the true
probability distribution of the obstacles’ movements deviates, conditional value-at-risk (CVaR) has recently drawn a great
within a Wasserstein ball, from an available empirical distri- dealofinterestinmotionplanningandcontrol[8]–[11].The
bution. Another advantage is that it provides a probabilistic CVaRofarandomlossrepresentstheconditionalexpectation
out-of-sample performance guarantee of the risk constraint. −
of the loss within the (1 α) worst-case quantile of the
To develop a computationally tractable method for solving ∈
the distributionally robust model predictive control problem, loss distribution, where α (0,1) [12]. As claimed in [9],
we propose a set of reformulation procedures using (i) the CVaR is suitable for rational risk assessments in robotic
Kantorovich duality principle, (ii) the extremal representation applicationsbecauseofitscoherenceinthesenseofArtzner
ofconditionalvalue-at-risk,and(iii)ageometricexpressionof etal.[13].Inadditiontoitscomputationaltractability,CVaR
the distance to the union of halfspaces. The performance and
is capable of distinguishing the worst-case tail events, and
utility of this distributionally robust method are demonstrated
thusitiseffectivetotakeintoaccountrarebutunsafeevents.
through simulations using a 12D quadrotor model in a 3D
environment. WeadoptCVaRtomeasuretheriskofunsafetytoenjoythese
advantages.
I. INTRODUCTION The success of such risk-aware tools critically depends
on the quality of information about the probability distri-
Safety is one of the most fundamental challenges in the bution of underlying uncertainties, such as an obstacle’s
operation of robots and autonomous systems in practical en- random motion. If a poorly estimated distribution is used,
vironments, which are uncertain and dynamic. In particular, it may cause catastrophic behaviors of the robot, leading
the unpredicted motion of objects and agents often risks to collision. One of the simplest and most popular ways to
the collision-free navigation of mobile robots. To gather estimate the probability distribution is to collect the sample
information about an obstacle’s uncertain movement, it is data of an obstacle’s movement and construct an empirical
typicaltouse(historical)sampledataofitsmotion.Themain distribution.Theuseofanempiricaldistributionisequivalent
goalofthisworkistodevelopanoptimization-basedmethod to a sample average approximation (SAA) of the stochastic
for risk-aware motion planning and control by incorporating programs [14]. Even though SAA is quite effective with
dataaboutmovingobstaclesintotherobot’sdecision-making asymptotic optimality, it does not ensure the satisfaction of
in a distributionally robust manner. risk constraints. The violation of risk constraints is likely to
Several risk-averse decision-making methods have been occur particularly with a small sample size.
proposed for collision avoidance in uncertain environments. In this paper, we propose a distributionally robust motion
Chance-constrained methods are one of the most popu- planning and control method to resolve the issue inherent
lar approaches as they can directly limit the probability in such empirical distributions. In the ﬁrst stage, a refer-
of collision. Because of their intuitive and practical role, ence trajectory is generated by using a rapidly exploring
chance constraints are extensively used in sampling-based random tree* (RRT*), given the initial position of obstacles.
planning[1]–[3]andmodelpredictivecontrol(MPC)[4],[5]. However, this trajectory may not be safe to track anymore,
However, it is computationally nontrivial to handle a chance as obstacles randomly move. To limit the risk of unsafety,
constraint because of its nonconvexity. This often limits we use a novel MPC method in the second stage. The
the admissible class of probability distributions and system proposed MPC method is carefully designed with CVaR
dynamics and/or requires an approximation. To resolve the constraints that must hold for any perturbation of the em-
issue of nonconvexity, a few theoretical and algorithmic pirical distribution within a tunable Wasserstein ball. Thus,
the resulting control decision guarantees to satisfy the risk
This work was supported in part by NSF under ECCS-1708906, the constraints for safety in the presence of distribution errors
Creative-PioneeringResearchersProgramthroughSNU,theBasicResearch
characterized by the Wasserstein ball. Another advantage
Lab Program through the National Research Foundation of Korea funded
bytheMSIT(2018R1A4A1059976),andSamsungElectronics. of the proposed method is that it provides a probabilistic
A. Hakobyan, and I. Yang are with the Department of Electrical out-of-sample performance guarantee, meaning that the risk
and Computer Engineering, Automation and Systems Research Institute,
{ constraints are satisﬁed with probability no less than a
SeoulNationalUniversity,Seoul08826,Korea, astghikhakobyan,
}
insoonyang @snu.ac.kr certain threshold even whenevaluated with new sample data
978-1-7281-7395-5/20/$31.00 ©2020 IEEE 490
Authorized licensed use limited to: UNIVERSITY OF ROCHESTER. Downloaded on September 20,2020 at 15:46:24 UTC from IEEE Xplore.  Restrictions apply. chosen independently of the training data. However, the
distributionallyrobustMPC(DR-MPC)problemisnontrivial
to solve because each worst-case CVaR constraint involves
an inﬁnite-dimensional optimization problem over the space
of probability distributions. To remove the issue of inﬁnite
dimensionality, we propose a set of reformulations by using
distributionally robust optimization techniques based on the
Kantorovich duality principle [15].
Therestofthepaperisorganizedasfollows:InSectionII,
we introduce the problem setup and the Wasserstein DR-
MPCtoolwithCVaRconstraintsforsafety.InSectionIII,we
propose a method to reformulate the DR-MPC problem into Fig. 1: Robot conﬁguration space with moving obstacles.
aﬁnite-dimensionalproblem.InSectionIV,theperformance
ofthedistributionallyrobustmethodisdemonstratedthrough
O O
simulations, using a quadrotor model in a 3D environment. where o(t)denotestheinteriorof (t).Duetotherandom
(cid:96) Y (cid:96)
motion of the obstacles, changes over time according to
(cid:96)
II. PROBLEMFORMULATION Y Y
(t+k)= (t)+w .
A. System and Obstacle Models (cid:96) (cid:96) (cid:96),t,k
B. Reference Trajectory Planning
In this paper, we consider a mobile robot with states
x(t) ∈ Rnx and control inputs u(t) ∈ Rnu evolving with Having information about the initial obstacle conﬁgura-
the following discrete-time motion model:1 tion,weﬁrstperformafastcollision-freetrajectoryplanning.
The resulting trajectory can then be traced by a motion
x(t+1)=Ax(t)+Bu(t). controller to be introduced later. Among several trajectory
generation techniques, we use a simple, yet quite efﬁcient
The robotic system is subject to the following state and
algorithm,calledtherapidlyexploringrandomtree*(RRT*)
control constraints:
[16]. It is an extension of RRT, which is based on a rapidly
∈X ∈U ∀ ≥
growing tree graph, where the nodes are randomly sampled
x(t) , u(t) t 0,
from the conﬁguration space. However, as opposed to RRT,
X ⊆ R U ⊆ R
where nx and nu are assumed to be convex RRT* provides an asymptotically optimal planning solution
sets. Since our goal is the motion planning and control of by using neighbor search and tree rewriring.
the robotic vehicle, we regard its current position in the n -
y∈ C. Measuring Safety Risk Using CVaR
dimensional conﬁguration space as the system output y(t)
Rny, which can be modeled by As the obstacles start to randomly move, the reference
trajectory generated in the planning stage may no longer be
y(t)=Cx(t). safe to follow. To systematically limit the risk of collision,
we use the notion of safety risk introduced in our previous
For its safety, the robot must avoid L randomly moving
O ⊂ R work [17].
rigid body obstacles. Let (cid:96)(t) ny denote the region To begin with, we deﬁne the loss of safety regarding
occupied by obstacle (cid:96) at stage t. For any obstacle (cid:96) that is
not a convex polytope, we over-approximate it as a polytope obstacle (cid:96) at stage t bYy the deviation of the robot’s position
and choose its convex hull as O (0). We assume that the from the safe region (cid:96)(t):
(cid:96) Y (cid:107) − (cid:107)
obstacle’s movement between two stages is modeled by
dist(y(t), (t)):= min y(t) a .
(cid:96) ∈Y 2
translations:2 a (cid:96)(t)
Y
O O Ideally, it is desirable to ensure dist(y(t), (t)) = 0 for
(t+k)= (t)+w , (cid:96)
(cid:96) (cid:96) (cid:96),t,k all t and (cid:96). However, such a deterministic guarantee would
willhuesrteratwed(cid:96),ti,nkFiisg.a1.rHanedroe,mthterasnusmlatoiofnavseetctAorainndRanvye,ctaosr lTeoadsytsotemaavtiecrayllycornesseorlvvaetivtheisdiescsiuseio,nwefortakmeotaiorniskc-oanwtraorle.
w is deﬁned by A+(cid:84)w :={a+w |a∈A}. approach by using CVaR. Speciﬁcally, we limit the safety
It is desirable for the robot to navigate in the safe region, risk regarding obstacle (cid:96) as follows:
Y
which is deﬁned by L(cid:96)=1 (cid:96)(t), where CVaRα[dist(y(t),Y(cid:96)(t))]≤δ(cid:96) ∀t, ∀(cid:96), (1)
Y R \O ∀ ≥
(cid:96)(t):= ny (cid:96)o(t) t 0, wChVearRe δ[(cid:96)Xis]:a=umseirn-sp∈eRcEiﬁ[zed+r(isXk-−tolze)ra+n/c(e1p−arαa)m],e3tearn.dHtehrues,
α z
1The reformulation results in Section III remain valid for nonlinear the safety risk measures the conditional expectation of the
systems. However, we focus on linear systems because the computational −
costsofnonlinearMPCareoftenprohibitive. safetylosswithinthe(1 α)worst-casequantileofthesafety
2Ourmethodcanalsohandletherotationofobstaclesbyusingthemodel loss distribution.
proposed in our previous work [11]. However, for ease of exposition, we
{ }
onlyconsidertranslations. 3Throughoutthispaper,let(x)+:=max x,0 .
491
Authorized licensed use limited to: UNIVERSITY OF ROCHESTER. Downloaded on September 20,2020 at 15:46:24 UTC from IEEE Xplore.  Restrictions apply. D. Wasserstein Distributionally Robust MPC control action is robust against distribution errors character-
ized by the ambiguity set.
To compute CVaR in the risk constraint (1), we need
the probability distribution of w ’s. Unfortunately, it is Inthiswork,wechoosetheambiguitysetasaWasserstein
(cid:96),t,k
difﬁcult to obtain a reliable distribution in practice. In many ballcenteredattheempiricaldistribution(2).Moreprecisely,
{ }
cases, we only have a few sample data wˆ(1) ,...,wˆ(Nk)
(cid:96),t,k (cid:96),t,k D { ∈P W | ≤ }
of w(cid:96),t,k. Oneof thesimplest w(cid:88)ays toincorporate these data (cid:96),t,k := µ ( ) W(µ,ν(cid:96),t,k) θ , (4)
is to use the following empirical distribution: P W
where ( ) denotes the set of Borel probability measures
W
1 Nk on the support . Here, th(cid:110)e(cid:90)Wasserstein metric of order 1
ν(cid:96),t,k := N δwˆ(i) , (2) is deﬁned by
k (cid:96),t,k
i=1
(cid:107) − (cid:48)(cid:107) (cid:111) (cid:48)
wHhowereeveδrw, wishetnhethDeinraucmbdeerltaofmseaamsuprlee dcoatnac,enNtrka,teids samtawll., W(µ,ν):=κ∈mP(iWn2) |W2 w w dκ(w,w )
the control decision made using the empirical distribution Π1κ=µ,Π2κ=ν ,
may not satisfy the original risk constraint (1).
(cid:107)·(cid:107)
Toovercomethisissueoflimiteddistributioninformation, whereΠiκdenotestheithmarginalofκfori=1,2,and
we formulate the following distributionally robust MPC is an arbitrary norm on Rny. The Wasserstein distance be-
(DR-MPC) problem:4(cid:88) tween two probability distributions represents the minimum
− cost of redistributing mass from one to another by using a
K 1
inf J(x(t),u):= r(x ,u )+q(x ) (3a) nonuniform perturbation. It is worth mentioning that other
k k K
u,x,y types of ambiguity sets can be chosen in the proposed DR-
k=0
s.t.x =Ax +Bu (3b) MPCformulation.Apopularchoiceindistributionallyrobust
k+1 k k
optimization are moment-based ambiguity sets [25]–[27].
y =Cx (3c)
k k However, such ambiguity sets are often overly conservative
x0 =x(t) (3d) and require a large sample size to reliably estimate moment
∈X ∈U
x , u (3e) information. Statistical distance-based ambiguity sets have
k k
Y ≤ ∀
sup CVaRµ(cid:96),t,k[dist(y , (t+k))] δ , (cid:96) also drawn a great interest, by using phi-divergence [28]
µ(cid:96),t,k∈D(cid:96),t,k α k (cid:96) (cid:96) and Wasserstein distance [15], [29]–[31], among others.
(3f) However, compared to other statistical distance-based ones,
Wasserstein ambiguity sets contain a richer set of relevant
where u := (u ,...,u − ), x := (x ,...,x ), y :=
0 K 1 0 K distributions and provide a better ﬁnite-sample performance
(y ,...,y ), where all the constraints must hold for k =
0 K ∈U guarantee [15].
0,...,K, except for (3b) and u in (3e), which should
− k
hold for k = 0,...,K 1. Once an optimal solution u(cid:63)
III. FINITE-DIMENSIONALREFORMULATIONVIA
is computed given x(t), the ﬁrst component u(cid:63) is selected
0 KANTOROVICHDUALITY
as the control input at stage t, i.e., u(t) := u(cid:63). The MPC
0
problem is deﬁned in a receding horizon manner for each The Wasserstein DR-MPC problem (3) is nontrivial to
stage. The cost functions are selected so as to penalize the solve because of the worst-case CVaR constraint (3f). The
(cid:80)
deviation of the states from the reference trajectory and maximization problem in the constraint is over the space of
large control inputs. In particular, we let J(x(t),u) := probability distributions, and thus it is inﬁnite dimensional.
− (cid:107) − (cid:107) (cid:107) (cid:107) (cid:107) − (cid:107) ∈
K 1 y yref 2 + u 2 + y yref 2, where yref Inthissection,weproposeasetofprocedurestoreformulate
R k=0 k k Q k R K K P k
nx is the reference trajectory generated in Section II-B; (3) as a ﬁnite-dimensional problem. For ease of exposition,
(cid:23) (cid:31)
Q 0, R 0 are the state and control weighting matrices, we consider
(cid:23)
respectively;andP 0ischoseninawaytoensurestability. Y ≤
The constraints (3b) and (3c) are for evolving the system supCVaRµ[dist(y, +w)] δ (5)
∈D α
states and outputs over the MPC horizon starting from x , µ
0 (cid:91)
which is set to be the current state x(t). The state and input instead of (3f), by suppressing the subscripts in (3f). Here,
constraints are speciﬁed in (3e).
The most important part in this problem is the constraint Y := m {y |c(cid:62)y ≥d } (6)
(3f). The left-hand side of this inequality represents the j j
j=1
worst-case value of CVaR when the probability distribution
D represents the safe region in the presence of an obstacle,
µT(cid:96)h,et,rkefolirees,binylaimgitiivnegnthseetwor(cid:96)s,tt,-kc,ascearllieskdvaanluea,mthbeigrueistuyltsinetg. which is the convex polytope {y |c(cid:62)j y ≤dj,j =1,...,m}.
4Distributionally robust optimization has been used for sequential de- A. Distance to the Union of Halfspaces
cision making in conjunction with Markov decision processes/optimal Y
control[18]–[23],safety/reachabilityspeciﬁcation[24],andRRT[3],among The ﬁrst step is to simplify the loss of safety, dist(y, +
others. However, we use MPC to revise the control decision online in w), by noticing that the safe region is a union of halfspaces.
responsetotheobstacles’randommovements.
492
Authorized licensed use limited to: UNIVERSITY OF ROCHESTER. Downloaded on September 20,2020 at 15:46:24 UTC from IEEE Xplore.  Restrictions apply. B. Reformulation of DR-CVaR Constraints
Y
Wenowusethesimpliﬁedrepresentationofdist(y, +w)
to reformulate the distributionally robust CVaR (DR-CVaR)
constraint(5)inaconservativemanner,whichissuitablefor
our purpose of limiting safety risk.
Lemma 2. Suppose that the safe region is given by (6). The
following inequality holds:
(cid:2)Y ≤ (cid:3)
supCVaRµ[dist(y, +w)]
∈D α
µ
Fig.2:Illustrationofthedistancetotheunionofhalfspaces. sup ∈DEµ max{min f (y,w),z,0}−z
inf z+ µ −j j , (9)
z∈R 1 α
− (cid:62) −
Lemma1. Supposethatthesafe(cid:26)regionisgivenby(6)(cid:27).Then, where fj(y,w)= dj (cid:107)ccjj((cid:107)y2 w), j =1,...,m.
the following equality holds:
Its proof is contained in Appendix I, which uses the
− (cid:62) − extremal representation of CVaR and the minimax inequal-
Y (d c (y w))+
dist(y, +w)= min j (cid:107)j (cid:107) . ity. Note that the inner maximization problem in (9) still
j=1,...,m cj 2 involves optimization over a set of distributions. We now
use Kantorovich duality to further reformulate it as a ﬁnite-
dimensional optimization problem. More speciﬁcally, we
Proof. By (6), we ﬁrst observe that
have the f(cid:104)ollowi(cid:110)ng dual representat(cid:111)ion o(cid:105)f the inner maxi-
Y { Y }
dist(y, +w)= min dist(y, +w) . (7) mization problem in (9):
j
j=1,...,m E −
sup(cid:104)µ max (cid:88)minf ((cid:104)y,w),(cid:110)z,0 z = (cid:111)
As illustrated in Fig. 2, the distance between y and each µ∈D j j
halfspace can be represented as
N
1 (cid:105)(cid:105) (10)
dist(y,Yj+w)=inf{(cid:107)t(cid:107)2 |y−w−a=t,c(cid:62)j a≥dj}. (8) λin≥f0 λθ+ N i=1wsu∈pW max mjinfj(y,w),z,0
a,t − − (cid:107) − (cid:107)
z λ w wˆ(i) .
The Lagrangian of this problem is given by
It is shown that there is no duality gap [30, Theorem 1].
(cid:107) (cid:107) − (cid:62) (cid:62) − − −
L(a,t,λ,γ)= t 2+λ(dj cj a)+γ (y w a t). Proposition (cid:104)1. Sup(cid:110)pose that W := {w ∈ R(cid:111)ny |(cid:105)Hw ≤ h},
∈R × ∈R
The corresponding Lagrange dual function is obtained as where H q ny and h q. Then, the following holds:
(cid:107) (cid:107) − (cid:62) − − (cid:62) sup Eµ m(cid:88)ax min f (y,w),z,0 −z =
g(λ,γ)=intf( t 2 γ t)+inaf( γ λcj) a µ∈D j=1,...,m j
(cid:62) −
+λd +γ (y w). N
j
(cid:40) inf λθ+ s
i
Note that λ,s,ρ,γ,η,ζ
i=1
(cid:104) − (cid:105) (cid:104) − (cid:105)≤
(cid:107) (cid:107) ≤ s.t. ρ ,G(y wˆ(i))+g + γ ,h Hwˆ(i) s +z
intf{(cid:107)t(cid:107)2−γ(cid:62)t}= 0−∞ ioftheγrw2ise.1 (cid:104)(cid:104)ηii,h−−Hwˆ(i)(cid:105)(cid:105)≤≤si+z i i
 ζ ,h Hwˆ(i) s
Therefore, the dual problem of (8) can be written as (cid:107)Hi (cid:62)γ −G(cid:62)ρ (cid:107)∗ ≤iλ
i i
(cid:62) − (cid:107) (cid:62) (cid:107) ≤
ms.ta.xγ,λ λ(cid:107)γγd=≥(cid:107)j2+−≤λγc1j(y w) =ms(cid:18).ta.xλ λλλd(cid:107)≥cjj−0(cid:107)2λ≤c(cid:62)j1(y(cid:19)−w) (cid:107)(cid:104)ρHH,(cid:62)eηζ(cid:105)ii=(cid:107)∗∗1≤λλ
λ 0 i≥ ≥ ≥ ≥
max λ(d −c(cid:62)(y−w)) − (cid:62) − γi 0, ρi 0, ηi 0, ζi 0,
λ ≤j j d c (y w) +
= s.t. λλ≥0(cid:107)cj1(cid:107)2 = j (cid:107)jcj(cid:107)2 . wnohremre(cid:107)a·l(cid:107)l∗thiescdoenﬁsnterdaibnyts(cid:107)hzo(cid:107)ld∗ :f=orsiu∈=p(cid:107)R1ξ(cid:107),≤.×.1.(cid:104),zN,ξ,(cid:105)a,nwdhethree(cid:104)d·u,a·(cid:105)l
denotestheinnerproduct.Here,G m ny isamatrixwith
Combining this with (7), the result follows directly from rows (cid:107)−c(cid:107)(cid:62)j , j = 1,...,m, g ∈ Rm is a column vector with
strong duality, which holds because the primal problem entriescj(cid:107)d2j(cid:107) , j = 1,...,m, and e ∈ Rm is a vector of all
satisﬁes the weak Slater’s conditions, as the inequality con- ones. cj 2
straints are linear and the primal problem is feasible [32,
Section 5.2.2]. A proof of this proposition can be found in Appendix II.
493
Authorized licensed use limited to: UNIVERSITY OF ROCHESTER. Downloaded on September 20,2020 at 15:46:24 UTC from IEEE Xplore.  Restrictions apply. C. Reformulation of DR-MPC Problem and Out-of-Sample IV. SIMULATIONRESULTS
Performance Guarantee
In this section, we present simulation results, demonstrat-
ByusingLemma2andProposition1,wecanreformulate
(cid:88) ing the performance and utility of the distributionally robust
the Wasserstein DR-MPC problem (3) as follows:
method. Consider a quadcopter navigating in a 3-D envi-
− −
K 1 ronment with the following linear dynamics: x¨ = gθ,y¨ =
−
us,,xρi,,nyγ,,fzη,,λζ,J(x(t),u):= k=0 r(xk,uk)+q(xK) (11a) gmφ,is¨zth=equma1duro1,toφ¨r’s=mIaxlsxsu,g2,iθ¨st=heIgylryauv3it,aψt¨io=nalIazlzccue4l,erwathioerne,
s.t.xk+1 =Axk(cid:104)+Buk (cid:88) (cid:105) (11b) apnridncIixpxl,eIayxyeasnidnItzhzeabroedtyhefraarmeaem.Tohmeeqnutsadorfoitnoerrtiina3aDbousptathcee
x =x(t) (11c)
0 isexpressedbyitpositionandorientation—(x,y,z,φ,θ,ψ).
1 1 Nk ≤ There are two polytopic obstacles randomly moving in the
z + − λ θ+ s δ (11d)
(cid:96),k 1 α (cid:96),k N (cid:96),k,i (cid:96) space as shown in Fig. 3. The following parameters are
k
(cid:104) − i=1(cid:105) used in simulations: m = 0.65 kg,l = 0.23 m,I =
ρ ,G (Cx wˆ(i) )+g (11e) · · xx ·
(cid:96),k,i t k (cid:96),t,k t 0.0075 kg m2,I = 0.0075 kg m2,I = 0.013 kg
(cid:104) − (cid:105)≤ yy zz
+ γ ,h Hwˆ(i) s +z (11f) m2,g =9.81ms2, δ =0.02, and α=0.95.
(cid:96),k,i (cid:96),t,k (cid:96),k,i (cid:96),k
(cid:104) − (cid:105)≤ Using the proposed method, a reference trajectory is
η ,h Hwˆ(i) s +z (11g)
(cid:96),k,i (cid:96),t,k (cid:96),k,i (cid:96),k ﬁrst generated by using RRT*. Then, the quadrotor starts
(cid:104) − (cid:105)≤
ζ ,h Hwˆ(i) s (11h) following the trajectory while avoiding obstacles by solving
(cid:96),k,i (cid:96),t,k (cid:96),k,i
(cid:107)H(cid:62)γ −G(cid:62)ρ (cid:107)∗ ≤λ (11i) the DR-MPC problem for T = 50. The MPC horizon and
(cid:107) (cid:62) (cid:96),k,i(cid:107) ≤t (cid:96),k,i (cid:96),k the weights are set to K = 10, Q = P = I, R = 0.001I.
H η(cid:96),k,i ∗ λ(cid:96),k (11j) In the following experiments, the two obstacles’ random
(cid:107) (cid:62) (cid:107) ≤
H ζ ∗ λ (11k) movements in each direction for stage t + k are sampled
(cid:96),k,i (cid:96),k
(cid:104) (cid:105)
ρ(cid:96),k,i,e =1 (11l) fromanormaldistributionwithmeanµ1 =0.02,µ2 =0and
≥ variance σ2 = 0.2,σ2 = 0.2. The DR-MPC problem (11)
γ ,ρ ,η ,ζ 0 (11m) 1 2
(cid:96),k∈,iX(cid:96),k,i ∈(cid:96),Uk,i (cid:96),k,i∈R wasmodeledinAMPL[35]andsolvedbyusingtheinterior-
xk , uk , z(cid:96),k , (11n) point method-based solver in Artelys Knitro 12.0 [36].
wherealltheconstraintsholdfork =0,...,K,(cid:96)=1,...,L In practice, only a small number of sample data may be
∈
and i=1,...,N , except for the constraint (11b) and u available.Thus,onlyN =5dataareusedinallsimulations.
U k − k
in (11n), which should hold for k = 0,...,K 1. The We compare the standard SAA approach (e.g., [11]) and the
control decision obtained by solving the reformulated prob- proposed distributionally robust method. Fig. 3 shows the
lemsatisﬁestheoriginalDR-CVaRconstraint(3f)becauseof resulting trajectories at different time stages. At each stage,
Lemma 2 and Proposition 1. Thus, the safety risk is limited the quadrotor observes the current obstacles position and
by the pre-speciﬁed threshold even when the actual distri- makes a control decision accordingly. As shown in Fig. 3
bution deviates from the empirical distribution (2) within (a), in early stages, the quadrotor trajectories controlled by
the Wasserstein ball (4). Another advantage is to assure a the SAA and distributionally robust methods are similar to
× − × −
probabilistic out-of-sample performance guarantee, i.e., the each other for θ = 1.5 10 3,2 10 3. However, for
× −
safetyriskconstraintissatisﬁedwithprobabilitynolessthan θ = 3 10 3, the quadrotor immediately starts avoiding
−
a certain threshold, 1 β, even when evaluated under a set the ﬁrst obstacle, even when it is not close. At t = 16, the
of new samples chosen independently of the training data. quadrotor controlled by the SAA method collides with the
More(cid:8)precisely,foracarefullychosenWas(cid:9)sersteinballradius ﬁrst obstacle (marked with a red circle). This indicates that
θ an optimal (u(cid:63),x(cid:63)) satisﬁes the following inequality:5 the SAA method with a very small sample size is not able
to satisfy the safety risk constraints and leads to collision.
Y ≤ ≥ − ∀
µN CVaRµ[dist(Cx(cid:63), (t+k))] δ 1 β k, Meanwhile, the trajectories generated by DR-MPC remain
α k
safe and avoid the ﬁrst obstacle. This result shows the DR-
This ﬁnite-sample guarantee is the result of a measure
MPC’s practical advantage that it properly limits safety risk
concentration inequality for Wasserstein ambiguity sets [33,
even with a very small sample size.
Theorem 2]. More details can be found in [34].
The reformulated Wasserstein DR-MPC problem is non- When t = 36, the quadrotor has already passed the ﬁrst
obstacle as shown in Fig. 3 (b). It can be noticed that the
convex because the fourth constraint is bilinear; all the
trajectories for smaller Wasserstein ball radii start following
other constraints and the objective function are convex. This
the reference trajectory, while the trajectory generated with
problem can be solved by efﬁcient nonlinear programming
× −
algorithms such as interior-point methods. θ = 3 10 3 still keeps a safe distance from the ﬁrst
obstacle. The trajectories at t = 50 are shown in Fig. 3
5It is assumed that the true distribution has a light tail in the sense (c). Note that, as the Wasserstein ball radius increases, the
that Eµ[exp((cid:107)w(cid:107)c)] ≤ B for c > 1 and B > 0. The radius has quadrotor further deviates from the reference trajectory to
≥
the form of θ := [log(c1/β)/(c2N)]1/2 if N log(c1/β)/c2 and ensure a bigger margin for safety. This result is consistent
θc1,:=c2[>log0(.c1/β)/(c2N)]1/c if N < log(c1/β)/c2 for some constants with the fact that the DR-MPC makes a more conservative
494
Authorized licensed use limited to: UNIVERSITY OF ROCHESTER. Downloaded on September 20,2020 at 15:46:24 UTC from IEEE Xplore.  Restrictions apply. (a) t=16 (b) t=36 (c) t=50
Fig. 3: Quadrotor trajectories at difference stages controlled by the standard SAA method and the proposed distributionally
× − × − × −
robust method with Wasserstein ball radii θ =1.5 10 3,2 10 3,3 10 3. The quadrotor controlled by the SAA method
collides with the ﬁrst obstacle at t=16, while the proposed method achieves the collision-free operation of the quadrotor.
 (cid:80)
cwohnetnroal bdiegcgiseiroWn absysercsotenisnidbearlilngis luasregde.r distribution errors isn.tf.λ,s,ξ,ν λsuθp+[(cid:104)ξNi=1−siν ,w(cid:105)+min f (y,w)−z]
w i,1 −(cid:104)i,1 (cid:105)≤ j j
maWkienghatvoVeo.lCpfrOoorNpoCcsLoeUldlSisIaiOoNndSisaAtvrNoibDiduatFinoUcnTeaUllRiynErWaonbOuRestnKvdireocnismioenn-t = +s+uσσpWWw(([(cid:104)(cid:104)ννξiii,,12,2))−−−ν(cid:104)iξξ,ii2,,12,w,,ww(cid:105)ˆˆ(cid:105)((+ii))(cid:105)z≤] ssii
sup ξ ν ,w
with randomly moving obstacles. This method alleviates w i,3 −(cid:104)i,3 (cid:105)≤
+σW(ν ) ξ ,wˆ(i) s
the issue of using empirical distributions in safety-critical (cid:107) (cid:107) i≤,3 i,3 i
ξ ∗ λ, k =1,2,3,
i,k
systemsortasksbyexplicitlyallowingdistributionerrorsand (12)
making decisions robust against such errors. It also enjoys
the proposed ﬁnite-dimensional reformulation of associated where all the constraints hold for i = 1,...,N, and the
(cid:104) (cid:105)
MPC problems for computational tractability. As a future support funct(cid:104)ion σW is deﬁned by σW(z):=sup ∈W(cid:105)z,w .
w
research, the proposed method can be extended to achieve We now note that
thedistributionalrobustnessofrobot’sdecision-makingwhen (cid:26) (cid:104) − (cid:105) −
a Gaussian process model is used to predict the motion of sup ξ ν ,w + min f (y,w) z
obstacles. w∈Rny i,1 i,1 (cid:104) j−=1,...,m j(cid:105)−
sup ∈R ∈R ξ ν ,w z+τ
APPENDIXI =s.t. w ny,τ G(i,y1−wi),1+g ≥τe
PROOFOFLEMMA2  (cid:104) (cid:105)−
inf ≥ ρ,g+Gy z
Proof. By the deﬁnition of CVaR and Lemma 1, we have = s.t.ρ 0 G(cid:62)ρ=ξ −ν
Y E − (cid:104) (cid:105) i,1 i,1
CVaRµα−[dist(y, +w)]E=infz∈R µ[z+(minj[f−j(y,w)]+− ρ,e =1,
z)+/(1 α)]=inf ∈R µ[z+([min f (y,w)]+ z)+/(1
z j j
α)]. Next, we use the minimax inequality to obtain where the last equality follows from strong duality of linear
su∈pDCVaRµα[d(cid:20)ist(y,Y +w(cid:16))(cid:2)] (cid:3) (cid:17) (cid:21) pprroogbrleammmisinfge,aswibhleic.hSihmoilldasrlys,inwcee(cid:26)othbetaipnritmhaatl maximization
µ
≤zin∈Rf µsu∈pDEµ z+ 1−1α mjinfj(y,w) +−z + , ws∈uRpny[(cid:104)ξi,2−νi,2,w(cid:105)−z]=(cid:26)−∞z,, iofthξie,r2w=iseν,i,2
and therefore the result follows. (cid:104) − (cid:105) 0, if ξ =ν
sup ξ ν ,w = ∞ i,3 i,3
APPENDIXII w∈Rny i,3 i,3 , otherwise.
(cid:26) (cid:26)
PROOFOFPROPOSITION1 By the deﬁnition of support function, we also have
Proof. By [15, Th(cid:80)eorem 4.2], the dual problem in (10) can
be rewritten as (cid:104) (cid:8) (cid:9) σW(ν)= supw∈Rny (cid:104)ν,w≤(cid:105) = infγ≥0 (cid:104)γ(cid:62),h(cid:105)
inf λθ+ 1 N s(cid:105) s.t. Hw h s.t. H γ =ν,
s.t.λ,s supw∈NW mi=a1x iminj=1,...,mfj(y,w)−z,−z,0 where the last equality follows from strong duality of linear
− (cid:107) − (cid:107) ≤ programming, which holds because the uncertainty set is
λ w wˆ(i) s
≥ i nonempty. By substituting the results above into (12), we
λ 0 conclude that the proposed reformulation is exact.
495
Authorized licensed use limited to: UNIVERSITY OF ROCHESTER. Downloaded on September 20,2020 at 15:46:24 UTC from IEEE Xplore.  Restrictions apply. REFERENCES [25] G.C.CalaﬁoreandL.ElGhaoui,“Ondistributionallyrobustchance-
constrained linear programs,” Journal of Optimization Theory and
[1] B.Luders,M.Kothari,andJ.How,“ChanceconstrainedRRTforprob- Applications,vol.130,no.1,pp.1–22,2006.
abilisticrobustnesstoenvironmentaluncertainty,”inAIAAGuidance, [26] E. Delage and Y. Ye, “Distributionally robust optimization under
Navigation,andControlConference,2010. moment uncertainty with application to data-driven problems,” Op-
[2] A.BryandN.Roy,“Rapidly-exploringrandombelieftreesformotion erationsResearch,vol.58,no.3,pp.595–612,2010.
planning under uncertainty,” in IEEE International Conference on [27] W.Wiesemann,D.Kuhn,andM.Sim,“Distributionallyrobustconvex
RoboticsandAutomation,2011. optimization,” Operations Research, vol. 62, no. 6, pp. 1358–1376,
[3] T.Summers,“Distributionallyrobustsampling-basedmotionplanning 2014.
under uncertainty,” in IEEE/RSJ International Conference on Intelli- [28] A. Ben-Tal, D. Den Hertog, A. De Waegenaere, B. Melenberg, and
gentRobotsandSystems,2018. G. Rennen, “Robust solutions of optimization problems affected by
[4] L. Blackmore, M. Ono, and B. C. Williams, “Chance-constrained uncertainprobabilities,”ManagementScience,vol.59,no.2,pp.341–
optimalpathplanningwithobstacles,”IEEETransactionsonRobotics, 357,2013.
vol.27,no.6,pp.1080–1094,2011. [29] C.ZhaoandY.Guan,“Data-drivenrisk-aversestochasticoptimization
[5] N.E.DuToitandJ.W.Burdick,“Robotmotionplanningindynamic, withWassersteinmetric,”OperationsResearchLetters,vol.46,no.2,
uncertain environments,” IEEE Transactions on Robotics, vol. 28, 2018.
no.1,pp.101–115,2012. [30] R. Gao and A. J. Kleywegt, “Distributionally robust stochastic opti-
[6] L.Blackmore,M.Ono,A.Bektassov,andB.C.Williams,“Aproba- mizationwithWassersteindistance,”arXiv:1604.02199,2016.
bilisticparticle-controlapproximationofchance-constrainedstochastic [31] A. R. Hota, A. Cherukuri, and J. Lygeros, “Data-driven chance con-
predictivecontrol,”IEEETransactionsonRobotics,vol.26,no.3,pp. strainedoptimizationunderWassersteinambiguitysets,”inAmerican
502–517,2010. ControlConference,2019.
[7] A.Jasour,N.S.Aybat,andC.M.Lagoa,“Semideﬁniteprogramming [32] S. Boyd and L. Vandenberghe, Convex optimization. Cambridge
for chance constrained optimization over semialgebraic sets,” SIAM universitypress,2004.
JournalonOptimization,vol.25,no.3,pp.1411–1440,2015. [33] N.FournierandA.Guillin,“OntherateofconvergenceinWasserstein
[8] Y. Chow, A. Tamar, S. Mannor, and M. Pavone, “Risk-sensitive and distance of the empirical measure,” Probability Theory and Related
robustdecision-making:aCVaRoptimizationapproach,”inAdvances Fields,vol.162,no.3–4,pp.707–738,2015.
inNeuralInformationProcessingSystems,2015. [34] A.HakobyanandI.Yang,“Wassersteindistributionallyrobustmotion
[9] A. Majumdar and M. Pavone, “How should a robot assess risk? controlforcollisionavoidanceusingconditionalvalue-at-risk,”arXiv
towards an axiomatic theory of risk in robotics,” in International preprintarXiv:2001.04727,2020.
SymposiumonRoboticsResearch,2017. [35] R. Fourer, D. M. Gay, and B. W. Kernighan, “A modeling language
[10] S. Singh, Y.-L. Chow, A. Majumdar, and M. Pavone, “A framework formathematicalprogramming,”ManagementScience,vol.36,no.5,
fortime-consistent,risk-sensitivemodelpredictivecontrol:Theoryand pp.519–554,1990.
algorithms,”IEEETransactionsonAutomaticControl,vol.64,no.7, [36] R.H.Byrd,J.Nocedal,andR.A.Waltz,“Knitro:Anintegratedpack-
pp.2905–2912,2019. agefornonlinearoptimization,”inLarge-scalenonlinearoptimization.
[11] A.Hakobyan,G.C.Kim,andI.Yang,“Risk-awaremotionplanning Springer,2006,pp.35–59.
andcontrolusingCVaR-constrainedoptimization,”IEEERoboticsand
AutomationLetters,vol.4,no.4,pp.3924–3931,2019.
[12] R. T. Rockafellar and S. Uryasev, “Conditional value-at-risk for
generallossdistribution,”JournalofBanking&Finance,vol.26,pp.
1443–1471,2002.
[13] P.Artzner,F.Delbaen,J.-M.Eber,andD.Heath,“Coherentmeasures
ofrisk,”MathematicalFinance,vol.9,no.3,pp.203–228,1999.
[14] A.Shapiro,D.Dentcheva,andA.Ruszczyn´ski,LecturesonStochastic
Programming:ModelingandTheory,2nded. SIAM,2014.
[15] P. Mohajerin Esfahani and D. Kuhn, “Data-driven distributionally
robust optimization using the Wasserstein metric: performance guar-
anteesandtractablereformulations,”MathematicalProgramming,vol.
171,pp.115–166,2018.
[16] S.KaramanandE.Frazzoli,“Sampling-basedalgorithmsforoptimal
motion planning,” The International Journal of Robotics Research,
vol.30,no.7,pp.846–894,2011.
[17] S.SamuelsonandI.Yang,“Safety-awareoptimalcontrolofstochastic
systemsusingconditionalvalue-at-risk,”inAmericanControlConfer-
ence,2018.
[18] H. Xu and S. Mannor, “Distributionally robust Markov decision
processes,” Mathematics of Operations Research, vol. 37, no. 2, pp.
288–300,2012.
[19] P. Yu and H. Xu, “Distributionally robust counterpart in Markov
decisionprocesses,”IEEETransactionsonAutomaticControl,vol.61,
no.9,pp.2538–2543,2016.
[20] I. Yang, “A convex optimization approach to distributionally robust
MarkovdecisionprocesseswithWassersteindistance,”IEEEControl
SystemsLetters,vol.1,no.1,pp.164–169,2017.
[21] B. P. G. Van Parys, D. Kuhn, P. J. Goulart, and M. Morari, “Dis-
tributionally robust control of constrained stochastic systems,” IEEE
TransactionsonAutomaticControl,vol.61,no.2,pp.430–442,2016.
[22] I.Yang,“Wassersteindistributionallyrobuststochasticcontrol:Adata-
drivenapproach,”arXivpreprintarXiv:1812.09808.,2018.
[23] I. Tzortzis, C. D. Charalambous, and T. Charalambous, “Inﬁnite
horizonaveragecostdynamicprogrammingsubjecttototalvariation
distance ambiguity,” SIAM Journal on Control and Optimization,
vol.57,no.4,pp.2843–2872,2019.
[24] I. Yang, “A dynamic game approach to distributionally robust safety
speciﬁcationsforstochasticsystems,”Automatica,vol.94,pp.94–101,
2018.
496
Authorized licensed use limited to: UNIVERSITY OF ROCHESTER. Downloaded on September 20,2020 at 15:46:24 UTC from IEEE Xplore.  Restrictions apply. 
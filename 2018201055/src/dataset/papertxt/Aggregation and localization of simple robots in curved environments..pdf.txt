2020 IEEE International Conference on Robotics and Automation (ICRA)
31 May - 31 August, 2020. Paris, France
Bounded haptic teleoperation of a quadruped robot’s foot posture for
sensing and manipulation
Guiyang Xin1, Joshua Smith1, David Rytz2, Wouter Wolfslag1, Hsiu-Chin Lin3 and Michael Mistry1
Abstract—This paper presents a control framework to tele- base, which greatly extends the versatility of quadruped
operate a quadruped robot’s foot for operator-guided haptic robots in real world deployment.
exploration of the environment. Since one leg of a quadruped
A fully optimization-based whole-body controller called
robot typically only has 3 actuated degrees of freedom (DoFs),
hierarchical quadratic programming (HQP) has been widely
the torso is employed to assist foot posture control via a hier-
archicalwhole-bodycontroller.Thefootandtorsoposturesare used on legged robots [6][7][8][9]. Multiple tasks are en-
controlled by two analytical Cartesian impedance controllers codedbysequentialstrictlynull-spaceprioritizedQPs,which
cascadedbyanullspaceprojector.Thecontactforcesactingon solve for the torque commands while taking into account
supportingfeetareoptimizedbyquadraticprogramming(QP).
joint space dynamics and physical constraints. Solving sev-
The foot’s Cartesian impedance controller may also estimate
eral QPs online is still time consuming, although decom-
contact forces from trajectory tracking errors, and relay the
force-feedback to the operator. A 7D haptic joystick, Sigma.7, position methods are developed to reduce the number of
transmits motion commands to the quadruped robot ANYmal, decision variables. Usually three QPs have to be solved for
and renders the force feedback. Furthermore, the joystick’s dynamic feasibility, operational tasks and saving energy [5].
motionisboundedbymappingthefoot’sfeasibleforcepolytope
Alternatively a non-strictly prioritized weighted QP (WQP)
constrained by the friction cones and torque limits in order
is used to avoid solving sequential QPs by stacking task
to prevent the operator from driving the robot to slipping or
falling over. Experimental results demonstrate the efﬁciency of equations into a weighted quadratic cost function [10][11].
the proposed framework. Alternatively, projected inverse dynamics is proposed by
[12][13][14] to split up motion space and constraint space
I. INTRODUCTION so that only one QP in constraint space needs to be solved.
In [15], we derived operational space dynamics for ﬂoating
Haptic teleoperation plays an important role in robotic
baserobotsandthenobtainedanalyticalCartesianimpedance
application cases, such as robot-assisted surgery and nuclear
controllers in motion space. Although a QP optimization is
facility decommissioning. Vision-based teleoperation can be
still required to solve inequality constraints, the analytical
enhanced by haptic rendering., e.g., an user might want to
Cartesian impedance controller gives us the ability to set
remotely inspect a speciﬁc area through touching. Haptic
gains based on operational space inertia [16] and to esti-
feedback also helps visual perception when vision systems
mate external forces because of properly scaled gains. In
lose efﬁcacy in some special cases, e.g., lidar can give
this paper, we will apply that analytical method to haptic
wrong terrain maps when the terrain is covered by liquid or
teleoperation for sensing and manipulation.
grass. Exploring the environment using tactile sensors could
Since the hierarchical controller will sacriﬁce low level
mitigate errors in vision system results. In the literature a
tasks to satisfy high level tasks, one may not be able to
numberofhapticteleoperationworkswithsinglearmrobots
fulﬁll the constraints at the lower level. For example, if the
can be found, whereas teleoperating quadruped robots to do
foot controller has higher priority than the base controller,
manipulation and exploration has been studied little.
the base maymove outside the supportpolygon and become
Researchers have been working on taking full advantage
unstable. To avoid such failures, we need to set boundaries
of multi-legged robots to be more versatile. For humanoid
to restrict teleoperation movement. The commanded end-
robots it is natural to do manipulation using arms [1][2].
effector forces should also be bounded based-on physical
Equipping quadruped robots with an additional arm that is
criteria, as high acting force may cause the supporting feet
dedicatedtomanipulationtasksisacommonwaytoenhance
to slip and/or lose balance due to moment around support
locomanipulation [3][4][5] due to the fact that the leg of a
polygon edge generated by the acting force. Papers about
quadruped usually does not have enough DoFs nor a sufﬁ-
motion planning have discussed balance maintenance for
ciently large workspace to be competent at six dimensional
multiple contact cases [17][18]. This paper will present how
manipulationinCartesianspace.Whole-bodycontrollerscan
to appropriately restrict operator commands by mapping the
implement foot posture control by coordinating the leg and
end-effector feasible wrench polytope (FWP) [19][20] to
joystick boundaries.
1 G. Xin, J. Smith, W. Wolfslag, and M. Mistry are with Institute of
The contribution of this paper is twofold. Firstly, we ex-
Perception,ActionandBehaviour,SchoolofInformatics,TheUniversityof
Edinburgh,47Potterrow,Edinburgh,UKguiyang.xin@ed.ac.uk tendourhierarchicalCartesianimpedancecontrollertoadapt
2 D. Rytz is with the Oxford Robotics Institute at the University of to foot posture teleoperation, and the impedance controller
Oxford,UnitedKingdom.
is experimentally proved to be accurate enough to estimate
3 H.-C. Lin is with the School of Computer Science/Department of
ElectricalandComputerEngineeringatMcGillUniversity,Canada. contact forces. Secondly, the range of the teleoperation
978-1-7281-7395-5/20/$31.00 ©2020 IEEE 1431
Authorized licensed use limited to: La Trobe University. Downloaded on September 21,2020 at 13:01:41 UTC from IEEE Xplore.  Restrictions apply. joystickisboundedwithrespecttothephysicalconstraintsto foot, J ∈ R6×(n+6). F and F , derived from operational
s s b
ensuresafeteleoperation.Tothebestofauthors’knowledge, space dynamics, are Cartesian impedance controllers for the
this is the ﬁrst time to achieve haptic teleoperation of foot swing foot and the base. N is the dynamic consistent null-
s
posture for quadruped robots in the literature. spaceprojector[21]oftheswingfoot,whichenforcesstrictly
hierarchical priorities. In the case of foot posture control,
II. CONTROLFRAMEWORK
N willdealwiththeoverlapbetweenJ andJ ,leadingto
s s b
The joint space dynamics equation of a quadruped robot the convenience of leaving base Jacobian J to be always
b
is a R6×(n+6) matrix. As the torso is in the null-space of
Mq¨+h=Bτ +J⊤c λc (1) the swing foot, the torso is enforced to satisfy the swing
foot’smotionrequirement,whichresultsinautomaticmotion
where q = (cid:2)x⊤ q⊤(cid:3)⊤ denotes the vector of n actuated
b j coordination and reachability extension of foot.
joint positions (q ∈ Rn) and ﬂoating base position and
j The generic equation of the Cartesian impedance control
orientation (x ∈ SE(3)), M ∈ R(n+6)×(n+6) is the inertia
b law for F and F is
matrix, h ∈ Rn+6 is the generalized vector containing s b
Coriolis, centrifugal and gravitational effects, τ ∈ Rn+6 F =h +Λ x¨ −D e˙ −K e , i=s or b (10)
i c,i c,i d,i d,i i d,i i
is the vector of torques, J ∈ R3k×(n+6) is the constraint
c
where h represents the operational space gravity com-
Jacobian that describes 3k linearly independent constraints, c
k denotes the number of supporting feet, λ ∈ R3k are pensation vector, Λc denotes the operational space inertia
c
matrix,D andK arediagonalmatricescontainingdesired
constraint forces acting on supporting feet, and d d
damping and stiffness gains, e=x−x is the pose error of
d
B=(cid:20)06 0(cid:21) (2) end-effector (either the base or the swing foot), x¨d denotes
0 In desiredaccelerationofend-effector.Wereferto[15]formore
details of h and Λ .
is the selection matrix with n dimensional identity matrix c c
TheimpedancecontrollawEq.(10)leadstothefollowing
I . Eq. (1) is subject to the following physical constraints,
n
impedance behavior under external disturbances
J q¨+J˙ q˙ =0 (3)
c c
Λ ¨e+D e˙ +K e=F (11)
c d d x
τ ≤τ ≤τ , i=1,...,n (4)
min max where F = [f⊤ m⊤]⊤ ∈ R6 is the external wrench
x x x
q
µλ ≥ λ2 +λ2 , i=1,...,k (5) acting on the end-effector. Obviously if there is no external
z,i x,i y,i
disturbance,therobotwilltrackdesiredtrajectoryaccurately
λz,i ≥0, i=1,...,k (6) with the assumption of using a perfect model. Conversely,
we could measure motion error and then estimate external
whereEq.(3)meanssupportingfeetshouldnotmoverelative
disturbances [14],
to the ground, and Eqs. (4), (5) and (6) represent torque sat-
uration, friction cone and unilateral constraints respectively.
Fˆ =Λ ¨e+D e˙ +K e (12)
x c d d
A. Cartesian impedance controller
Modelerroralwaysexistsforrealrobotplatforms,leading
In paper [21], the authors suggested to use a null-space ˆ
to a F caused by both model error and disturbances. If
projector P=I−J+c Jc to split up (1) into two orthogonal the moxdel error is much smaller than disturbances, Fˆ is
x
subspaces,
accurate enough to be a contact force estimator. Here in our
PMq¨+Ph=PBτ =τ (7)
m experiments, we employ this estimation as haptic feedback
(I−P)(Mq¨+h)=(I−P)Bτ+J⊤λ =τ +J⊤λ (8) for teleoperation, and thus do not require a force/torque
c c c c c
sensor at the point of contact.
Eq.(7)representsmotionspacethatisnotaffectedbycontact Note that the torso motion error doesn’t affect the foot
forces of supporting feet; meanwhile, Eq. (8) represents dy- position error because the torso is controlled in the null-
namics in constraint space. The advantage of this separation space of the manipulation foot. If the base were ﬁxed, the
is that we can derive an analytical Cartesian impedance same external force, F , acting on the foot would result in
x
controller with Eq. (7) and solve a QP optimization to the same motion error, e , as when running our hierarchical
s
generate an extra torque command satisfying constraints of whole-body controller with a ﬂoating base. The difference
Eqs. (4-6) with Eq. (8) as shown in subsection II-B. The only exists in joint errors. We can always only measure the
ﬁnal torque command is composed of two parts as follows, motionofthefootandthenuseEq.(13)toestimateexternal
τ =(PB)+P(J⊤F +N J⊤F )+τ (9) force Fx without any torso motion error interfering.
s s s b b c
where the ﬁrst right side term is equivalent to τm resulting Fˆx =Λc,s¨es+Dd,se˙s+Kd,ses (13)
fromCartesianimpedancecontrolandτ istheresultofQP
c
B. QP optimization
optimization.J denotestheJacobianmatrixofaswingfoot,
s
the dimension of which depends on the control task. Since ThecontrolstructureisdepictedinFig.1wheretheinputs
we want to control both the position and orientation of the of QP optimization in constraint space are torques for the
1432
Authorized licensed use limited to: La Trobe University. Downloaded on September 21,2020 at 13:01:41 UTC from IEEE Xplore.  Restrictions apply. Mapping feasible force polytope
to restrict joystick
Force feedback
+ Estimation of contact force 
between swing foot and 
- surroundings
+ + +
Swing foot
5D Cartesian impedance control
- + + z
x y
Torso
+
6D Cartesian impedance control 
QP optimization for stance 
in the Null-space of swing foot
feet’s contact forces
-
In the Null-space of contact constraints
Forward kinematics
Fig.1. Schematicoffootposturecontrollerwithhapticteleoperation.
motion and state feedback, which implies the motion can motion boundaries on the joystick in order to give operators
affect contact forces λ as q¨ are involved in Eq. (8). We early notiﬁcations of approaching dynamically infeasible
c
solvetheforwarddynamicsofEq.(7)toderivetheequation areas.
of q¨ with respect to τ, and then substitute it into Eq. (8)
A. Boundaries on CoM position
to eliminate q¨. Since PM is not invertible, we resort to a
trick (provided in [21][12]) of using M =PM+I−P to To limit CoM motion, we look for the maximum range
c
replace PM in Eq. (7) as (I−P)q¨=P˙q˙ holds, leading to in each direction from the current foot position that will
keep the CoM within the support polygon. Theoretically,
q¨=M−1(τ −Ph+P˙q˙) (14)
c m we can use 6 DoFs to control foot posture meanwhile
using the remaining 3 DoFs to control the torso. The null-
where τ is the result from Cartesian impedance control in
m
space projector will automatically use the 3 DoFs for the
our case. Subsequently, substituting (14) into Eq. (8) yields
torso to guarantee the foot trajectory tracking if the 6 DoFs
λc =(Jc)+(cid:2)(I−P)[MM−c1(τm−Ph+P˙q˙)+h]−τc(cid:3) assigned to foot are not enough to achieve desired motion.
(15) Solving forward dynamics and simulating the system for a
Therefore, the QP in constraint space with respect to τc can time horizon can give us predicted robot state. If we want
be deﬁned as to calculate the boundary in Cartesian space, that will be
1 time consuming to predict. Instead of directly ﬁnding the
minimize kτ k2
2 c 2 boundaries of the foot, we shrink the supporting polygon
τc
subject to τ −τ ≤τ ≤τ −τ to be the boundary of CoM. When the CoM is close to
min m c max m (16) the boundary, joystick stiffness will increase to stop joystick
µ(η−J+c τc)z,i ≥qλ2x,i+λ2y,i moving along that direction.
(η−J+τ ) ≥0
c c z,i B. Boundaries for feasible acting forces
where η = (J )+(cid:0)I−P)[MM−1(τ −Ph+P˙q˙)+h] Since the joystick sends position commands to the
c c m
abbreviates the ﬁrst right side term of Eq. (15). τ in Eq. impedance controller, the impedance controller generates
m
(16) is regarded as a constant vector. The QP may have no acting forces based on the position errors. We can restrict
solution if the desired trajectory is not physically feasible, theworkspaceofjoysticktosaturatetheactingforce.Firstly,
which can be solved by using a motion planner subject to we need to compute the set of forces at the end-effector re-
physicalconstraints.Inthecaseofteleoperation,thismotion spectingjointtorquelimitsandthecontactforceconstraints.
is generated by the operator. Particularly when the robot has Such a set has been used to enhance motion planning of
interaction during a manipulation mission, the operator may robot manipulators [19]. The operational-space impedance
push the joystick too much resulting in slipping. The next controller gains from (11) are used to transform the set of
section will discuss how to set boundaries on the joystick in feasible end-effector forces to feasible displacements, and
order to avoid the operator breaking physical constraints. are subsequently mapped to feasible joystick commands.
The joystick will run a varying impedance controller to
III. FEASIBILITYBOUNDARIESFORTELEOPERATION sharply increase the stiffness when the operator is moving
An user may operate the joystick to execute commands the joystick into a infeasible position.
that are physically incapable for the robots. Instead of To compute the set of feasible forces at the end-effector,
simplyignoringsuchinfeasiblecommands,weproposetoset we extend the computational framework from [20], which
1433
Authorized licensed use limited to: La Trobe University. Downloaded on September 21,2020 at 13:01:41 UTC from IEEE Xplore.  Restrictions apply. computes the set of feasible wrenches applied at the torso
of the robot. As in that framework, we note the structure of
the equations of motion (1):
ddddd0123b=00000 0000I 0000I 0000I 0000Iττττ00123+JJ000⊤0⊤0,,0b JJ000⊤1⊤1,,1b JJ000⊤2⊤2,,2b JJ000⊤3⊤3,,3bλλλλ0123
(17)
where we have split the inertial forces (d = Mq¨+h), the
joint-torques, and the contact forces into parts associated
with the base and the separate legs and feet. Leg number
Fig.2. Thefeasibleforcepolytopeduringtheexperiment.Showninred
0performsthemanipulation,meaningtheassociatedλ0 will aretheforcesthatcanbeappliedtotheenvironment.Theforcepolytopeis
be 0. shownwiththeoriginshiftedtothecentreofthefootandusingascaling
of500Nm−1.
The bottom four rows provide a constraint between joint
torques and contact forces for each leg:
IV. EXPERIMENTS
λ =J−⊤(d −τ ), i=0,1,2,3 (18)
i i,i i i
The proposed algorithms are implemented on the
These equality constraints map the hypercube of allowed quadruped robot ANYmal2 and a Sigma.73 haptic joystick.
joint torques to a polytope of contact forces. For the stance- In practical manipulation cases the yaw of the foot with
legs these polytopes are intersected with the friction cone. respect to foot frame (z axis of foot frame coincides with
Any constraints on the contact force in manipulation, for the central axis of shank) has little to no effect on the task,
instance when interacting with fragile environments, can be so we chose not to control it. The remaining 5 dimensions
addedatthisstageaswell.Thisresultsinapolytope(FCPi) are controlled by the foot impedance controller as shown
of feasible contact forces for each separate leg. in Fig. 1. Not controlling the yaw helps in giving the
Finallythetoprowof(17)combinesthesepolytopeswith torso controller more authority in the null-space, otherwise
the dynamics of the robot torso, to form the feasible force the torso is quite sensitive to disturbance and non-smooth
polytope FFP for the manipulating leg: motion commands. The experiment videos can be found at:
https://www.youtube.com/watch?v=htI8202vfec.
3
FFP ={f ∈FCP | J⊤ f ∈(d −XJ⊤FCP )} (19)
0 0,b b i,b i A. Haptic joystick setup
i=1
The Sigma.7 haptic device used in Fig. 1 is connected to
where a sum of polytopes is taken to be their Minkowski
the quadruped using a WiFi connection and custom ROS
sum. The polytope-operations are handled using the CD-
node running on a different computer than the ANYmal
DLib1 library. Unfortunately the various transformations
with Ubuntu 18.04 LTS. The sensing and control cycle of
require multiple conversions between vertex and halfspace Sigma.7is100Hz,meanwhilethecontrolloopoflocomotion
representations,makingthecomputationofthefeasibleforce controller on ANYmal’s PC is 400Hz. The commercial
polytope expensive. As a result the polytopes are computed
versionfromForceDimensioncomeswithaSDKthatallows
ofﬂine with a simple look-up used for online access.
to easily access the device pose, twist and wrench of the
Figure 2 shows the feasible force polytope for a conﬁg- device end-effector while also applying a desired wrench.
uration in simulation. In this conﬁguration the robot can Forthisworkthedeviceposeisreadandaddedtothecurrent
exert little force upwards, as larger forces would shift the quadruped end-effector pose to generate the target pose. As
centre of pressure beyond the support polygon. The posture the workspace of the haptic device is signiﬁcantly smaller
of each surface of the polytope in world frame is deﬁned than the ANYmal one, the Sigma.7 gripper is used to reset
by the normal vector and the maximum feasible force along the end-effector command. To reduce the mental load on
this direction. In theory we need to project the contact force the operator and increase the stability of the quadruped the
on all these directions (37 for this conﬁguration) and then authors implemented the following measures:
compare the projection with the maximum feasible force
• Thehapticdevicestiffenswhenthequadrupedisreach-
along these directions. If the projected force is greater than
ing feasible limits as described in section III.
the maximum feasible force, that means the contact force
• As the quadruped might experience high contact forces
will break physical constraints. In practice we will shrink
the reported contact forces are only applied when the
the FFP corresponding to a certain conﬁguration to be the
operator presses the device gripper. In case of an open
boundary on the joystick. When any direction is close to the
gripper state the Sigma.7 device goes into it’s initial
boundary we will generate a force to prevent the joystick
base pose in the center of the workspace.
from entering the area and to inform the operator.
2Seehttp://www.anybotics.com/
1Seehttps://github.com/JuliaPolyhedra/CDDLib.jl 3Seehttp://www.forcedimension.com/
1434
Authorized licensed use limited to: La Trobe University. Downloaded on September 21,2020 at 13:01:41 UTC from IEEE Xplore.  Restrictions apply. (a) (b)
(c) (d)
Fig.3. TeleoperatingANYmaltopressthee-stopbuttonofacrane.
10
5
0
Fig.5. Teleoperatingthefootintoapipe
F/N -5
sensory fx
-10 sensory fy
sensory fz
estimated fx
-15 estimated fy
estimated fz
-20
0 5 10 15 20 25
t/s
Fig. 4. Force comparison between sensory results and estimated results
during pressing button experiment. The button was pressed at around 5s.
Fig. 6. Teleoperating the foot to reach the bottom covered by plastic
The contact forces suddenly changed at around 12s because the button
peanuts and sliding on the surface to establish the depth of the reliable
started to move. After pressing down, contact forces increased again. The
bottomsurface.
operator released the button at around 16s. Compared to noisy sensory
forces,theestimatedforcesarebettertobeusedashapticfeedback.
C. Pipe manipulation
B. Accuracy veriﬁcation of estimated contact force In this experiment we show-case the robot inserting its
foot into a pipe, via teleoperation. This scenario is relevant
The Cartesian impedance controller can estimate the con-
for industrial use and inspection tasks. The aim of this
tact force as well as the contact wrench. Usually we do
experiment is to show the whole-body controller can control
not need wrench feedback since the foot shape is a small
foot posture, since inserting the foot into the pipe demands
sphere, designed as a point foot. The ﬁrst experiment is to
accurately adjusting the foot orientation to be aligned with
verifyhowaccuratetheforceestimationbasedonimpedance
the pipe. Fig. 5 shows the snapshots of the process. We can
controller is. We teleoperated the robot to press an e-stop
see that the whole shank is ﬁnally inside the pipe. Moreover
button of a crane as shown in 3. The force sensor inside the
theentranceofthepipeisquitehighforANYmal.Werotated
foot is enabled to record sensory contact force to compare
the second joint more than π/ to reach the pipe. During
with estimated force by impedance controller. The Eq. (13) 2
that we moved through a singular conﬁguration as shown
is used to compute estimated forces. However, acceleration
in the second snapshot. The leg moved fast when trying to
and velocity are noisy. If the estimated force contains high
overcome singularity (as can be seen in the accompanying
frequency components it will cause oscillation on joystick
video), but this did not cause any issue on the robot, which
when rendering the feedback forces. In the end, we used
shows the robustness of the our controller.
only the position error to estimate the contact forces.
The recorded data is shown in Fig. 4. It should be noted
D. Exploring surface
that we set a threshold of 5N to ﬁlter the estimated force,
intendingtodiscriminatenon-contacterrorwhenswingingin In real world deployment, visual perception of solid sur-
theair.Thisthresholdcanexplainthespikesofestimatedfy, faces may be obscured by liquid, smoke, grass etc. The
and also leads to fz =0 because estimated fz is always less robot’s locomotion planner needs to know the accurate
than5Ninthisexperiment.Theforcedroppingataroundthe elevation map to plan foot placement. In this experiment
12smark,isduetothebuttonbeingfullypressed.Whenthe the operator teleoperates the robot to explore the surface
button reaches the bottom, the contact force increases until covered by some light packing peanuts. We place the robot
the operator feels that the button was completely pressed on a 20 cm high stage as shown in Fig. 6, such that the
down. robot needs to stretch its leg to reach the bottom. Beneﬁting
Based on Fig. 4 the estimated force is accurate enough from the hierarchical whole-body controller, the robot can
to be used as haptic feedback for teleoperation. Additionally automatically lower its torso to extend the reachability of
compared to noisy sensory forces (the sensory result shown theleg.Theoperatorthenexploresthesurfacebyslidingthe
in Fig. 4 has already been ﬁltered by a second order low footbackandforth.Ifwerecordedthefoottrajectoryduring
pass ﬁlter) the estimated force is easier to be projected onto slidingonthesurface,wecanestablishthegeometricalplane
the joystick. to update the elevation map.
1435
Authorized licensed use limited to: La Trobe University. Downloaded on September 21,2020 at 13:01:41 UTC from IEEE Xplore.  Restrictions apply. 0
-10
-20
N
F/
(a) (b) -30
Fig. 7. Pushing against scaffold. (a) Starting to push, (b) Right hind leg -40 estimated fx
slippingduetotoomuchpushingforce. estimated fy
estimated fz
-50
0 5 10 15 20 25 30 35
t/s
Fig.9. Estimatedcontactforcesduringpushingagainstascaffoldstructure.
Therighthindfootstartedtoslipataround25sbecausethecontactforces
wasgreaterthanthelimit.
(a) (b)
0
Fig.8. FFP oftheconﬁgurationinthepushingexperiment.(a)Sideview,
(b)Topview. -10
F/N-20
E. Feasible force polytope boundary
Inthisexperimentweverifythatsettingaboundaryonthe -30 estimated fx
estimated fy
joystick to restrict acting force is necessary. The robot was estimated fz
-40
operated to push against a scaffolding structure as shown 0 5 10 15 20 25 30 35
in Fig. 7. The FFP is calculated based on the measured t/s
conﬁguration when the robot is pushing as shown in Fig. Fig.10. Estimatedcontactforcesduringpushingagainstascaffoldstructure
8. The polytope for this conﬁguration has 33 surfaces. The withFFP boundaryrunning.Theoscillationcausedbypredeﬁnedpushing
backforcesaroundtheboundaryimpliestheboundaryistriggered.
smallest infeasible force in this conﬁguration is 25.6N with
direction(cid:2)0.08 −0.99 −0.11(cid:3)⊤.Toverifythecorrectness
of FFP, the operator kept pushing upward and forward in bytwoanalyticalCartesianimpedancecontrollersdecoupled
ordertotriggertheFFP limitationwithoutaboundarybeing by a dynamically consistent null-space projector. Motion
setonjoystick.TherecordedcontactforcesareshowninFig. control is performed by an analytical controller, such that
9.Therighthindlegslippedquicklyataround25swhenthe only one QP optimization needs to be solved to cope with
recorded forces jump up according to Fig. 9. The recorded theinequalityconstraints.Twoimpedancecontrollersforthe
data after 25s is irrelevant because the system crashed footposturecontrolandthetorsocontrolpotentiallyoverlap,
after detecting large slipping. We use the recorded forces to but the null-space projector imposes a strict priority, which
compute the projection along each direction of FFP. This beneﬁts the foot reachability. The foot impedance controller
shows that the projection of the contact force along with isalsousedtoestimatecontactforceswhenthemanipulation
direction(cid:2)−0.39 −0.04 0.92(cid:3)⊤ is30.69at23.5s.Thatis footisincontactwiththeenvironment.Experimentalresults
slightly greater than the model-predicted maximum feasible show the estimation accuracy of this method for haptic
value 30.68 in that direction, implying that the computed teleoperation. In order to avoid falling over due to infeasible
FFP is close to the real limit considering model error commands sent by operator, the CoM and the acting forces
and force estimation error. Subsequently, we repeated that are effectively bounded by limiting the joystick movement.
experiment with enabled FFP boundary on joystick. We These boundaries not only protect the robot, they also guide
shrunk the boundary to 80% for safety. The oscillation of the operator to move the joystick in feasible directions.
contactforceshowninFig.10happenedwhentheboundary Futureworkwillaimtoprovidepredictiveonlinecomputing
was triggered. The increased stiffness of joystick prevented algorithms for the CoM boundary.
the operator from sending infeasible commands.
ACKNOWLEDGMENT
V. CONCLUSIONS This work has been supported by the following grants:
EPSRC UK RAI Hub NCNR (EPR02572X/1) and ORCA
A hierarchical whole-body controller is successfully ap-
(EP/R026173/1), THING project in the EU Horizon 2020
plied to foot posture teleoperation of a quadruped robot
(ICT-2017-1),andbygrantEP/L016834/1fortheUniversity
ANYmal. The output torques of the whole-body controller
of Edinburgh RAS CDT from EPSRC.
consists of two orthogonal components: 1) motion torques
which are dedicated to execute mission commands without
REFERENCES
considering physical constraints, and 2) constraint torques
[1] O. C. Jenkins, R. Peters, and R. Bodenheimer, “Uncovering success
that are only for satisfying physical constraints without
in manipulation,” in Robotics: Science and Systems Workshop on
generatinganymovement.Themotiontorquesarecomputed ManipulationinHumanEnvironments,Philadelphia,PA,USA,2006.
1436
Authorized licensed use limited to: La Trobe University. Downloaded on September 21,2020 at 13:01:41 UTC from IEEE Xplore.  Restrictions apply. [2] C.G.Atkeson,B.P.W.Babu,N.Banerjee,D.Berenson,C.P.Bove, constrained multibody systems based on linear projection opera-
X.Cui,M.DeDonato,R.Du,S.Feng,P.Franklinetal.,“Nofalls,no tor: Applications to control and simulation,” IEEE Transactions on
resets:Reliablehumanoidbehaviorinthedarparoboticschallenge,”in Robotics,vol.21,no.5,pp.834–849,2005.
2015IEEE-RAS15thInternationalConferenceonHumanoidRobots [13] F.AghiliandC.-Y.Su,“Controlofconstrainedrobotssubjecttounilat-
(Humanoids). IEEE,2015,pp.623–630. eralcontactsandfrictionconeconstraints,”in2016IEEEinternational
[3] B. U. Rehman, M. Focchi, J. Lee, H. Dallali, D. G. Caldwell, and conference on robotics and automation (ICRA). IEEE, 2016, pp.
C. Semini, “Towards a multi-legged mobile manipulator,” in 2016 2347–2352.
IEEEInternationalConferenceonRoboticsandAutomation(ICRA). [14] H.-C. Lin, J. Smith, K. K. Babarahmati, N. Dehio, and M. Mis-
IEEE,2016,pp.3618–3624. try, “A projected inverse dynamics approach for multi-arm cartesian
[4] B. Dynamics. Introducing spotmini. Youtube. [Online]. Available: impedance control,” in IEEE International Conference on Robotics
https://www.youtube.com/watch?v=tf7IEVTDjng&t=59s andAutomation(ICRA). IEEE,2018,pp.1–5.
[5] C. D. Bellicoso, K. Kramer, M. Sta¨uble, D. Sako, F. Jenelten, [15] G. Xin, H.-C. Lin, J. Smith, O. Cebe, and M. Mistry, “A Model-
F.Bjelonic,andM.Hutter,“Alma-articulatedlocomotionandmanip- basedHierarchicalControllerforLeggedSystemssubjecttoExternal
ulation for a torque-controllable robot,” in International Conference Disturbances,”IEEE/RSJInt.Conf.onRoboticsandAutomation,pp.
onRoboticsandAutomation(ICRA2019),2019. 4375–4382,2018.
[6] M.DeLasa,I.Mordatch,andA.Hertzmann,“Feature-basedlocomo- [16] F.Angelini,G.Xin,W.J.Wolfslag,C.Tiseo,M.Mistry,M.Garabini,
tion controllers,” in ACM Transactions on Graphics (TOG), vol. 29, A.Bicchi,andS.Vijayakumar,“OnlineOptimalImpedancePlanning
no.4. ACM,2010,p.131. for Legged Robots,” IEEE International Conference on Intelligent
RobotsandSystems,2019.
[7] A. Escande, N. Mansard, and P.-B. Wieber, “Hierarchical quadratic
[17] K. Harada, S. Kajita, K. Kaneko, and H. Hirukawa, “Dynamics
programming: Fast online humanoid-robot motion generation,” The
and balance of a humanoid robot during manipulation tasks,” IEEE
InternationalJournalofRoboticsResearch,vol.33,no.7,pp.1006–
TransactionsonRobotics,vol.22,no.3,pp.568–575,2006.
1028,2014.
[18] H.Dai,A.Valenzuela,andR.Tedrake,“Whole-bodymotionplanning
[8] A. Herzog, N. Rotella, S. Mason, F. Grimminger, S. Schaal, and
with centroidal dynamics and full kinematics,” in 2014 IEEE-RAS
L. Righetti, “Momentum control with hierarchical inverse dynamics
International Conference on Humanoid Robots. IEEE, 2014, pp.
onatorque-controlledhumanoid,”AutonomousRobots,vol.40,no.3,
295–302.
pp.473–491,2016.
[19] H. Ferrolho, W. Merkt, C. Tiseo, and S. Vijayakumar, “Comparing
[9] C. Dario Bellicoso, C. Gehring, J. Hwangbo, P. Fankhauser, and
metrics for robustness against external perturbations in dynamic tra-
M. Hutter, “Perception-less terrain adaptation through whole body
jectoryoptimization,”arXivpreprintarXiv:1908.05380,2019.
controlandhierarchicaloptimization,”IEEE-RASInternationalCon-
[20] R. Orsolino, M. Focchi, C. Mastalli, H. Dai, D. G. Caldwell, and
ferenceonHumanoidRobots,pp.558–564,2016.
C. Semini, “Application of wrench-based feasibility analysis to the
[10] M. De Lasa and A. Hertzmann, “Prioritized optimization for task-
online trajectory optimization of legged robots,” IEEE Robotics and
spacecontrol,”in2009IEEE/RSJInternationalConferenceonIntel-
AutomationLetters,vol.3,no.4,pp.3363–3370,2018.
ligentRobotsandSystems. IEEE,2009,pp.5755–5762.
[21] M.MistryandL.Righetti,“Operationalspacecontrolofconstrained
[11] S.Feng,E.Whitman,X.Xinjilefu,andC.G.Atkeson,“Optimization
and underactuated systems,” Robotics: Science and systems VII, pp.
based full body control for the atlas robot,” IEEE-RAS International
225–232,2012.
ConferenceonHumanoidRobots,vol.2015-Febru,pp.120–127,2015.
[12] F. Aghili, “A uniﬁed approach for inverse and direct dynamics of
1437
Authorized licensed use limited to: La Trobe University. Downloaded on September 21,2020 at 13:01:41 UTC from IEEE Xplore.  Restrictions apply. 